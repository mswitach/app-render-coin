async function proyectarPedidos() {
  const spinner = document.getElementById("spinnerPedidos");
  const tabla = document.getElementById("tablaProyeccion").querySelector("tbody");
  const log = document.getElementById("logPedidos");
  spinner.style.display = "block";
  tabla.innerHTML = "";
  log.innerHTML = "";

  try {
    logPaso("logPedidos", "Solicitando proyecci√≥n a /pedidos...");
    const res = await fetch("/pedidos");
    logPaso("logPedidos", "Esperando respuesta del servidor...");

    const data = await res.json();

    if (data.error) {
      logPaso("logPedidos", "‚ùå Error: " + data.error);
      return;
    }

    logPaso("logPedidos", "üìÑ Resumen generado:");
    logPaso("logPedidos", "<pre style='margin-top: 0.5rem;'>" + data.resumen.slice(0, 1000) + "</pre>");

    logPaso("logPedidos", "üß† Ejecutando an√°lisis con agente...");
    logPaso("logPedidos", "‚úÖ An√°lisis recibido. Procesando resultados...");

    const texto = data.proyeccion;
    const lineas = texto.split("\n").filter(linea =>
      linea.toLowerCase().includes("cliente") && linea.includes(":")
    );

    for (const linea of lineas) {
      const match = linea.match(/Cliente\s+(\S+).*?(\d+)\s+pedidos?/i);
      if (match) {
        const codigo = match[1];
        const cantidad = match[2];
        const fila = `<tr><td>${codigo}</td><td>${cantidad}</td></tr>`;
        tabla.innerHTML += fila;
      }
    }

    logPaso("logPedidos", "‚úÖ Proyecci√≥n completada y mostrada.");

  } catch (error) {
    logPaso("logPedidos", "‚ùå Error inesperado: " + error.message);
  } finally {
    spinner.style.display = "none";
  }
}

